
### NonUniqueResultException 오류 발생 원인

```
Team team = em.find(Team.class, 7L);

Member member = new Member();  
member.setName("NEW");  
member.setAge(20);  
member.getInTeam(team);  
em.persist(member);  

Member singleResult = em.createQuery("select m from Member m where m.name = :username", Member.class).setParameter("username", "NEW").getSingleResult();


/* => 실행 결과 
* 2건 조회 되어 NonUniqueResultException 발생
*/
```

  - 이미 DB에 `NEW`라는 name 데이터가 존재하는데 위에서 또 `NEW`라는 name의 데이터를 추가함  
  - JPQL은 `FlushModeType.AUTO`(기본) 모드일때는 쿼리 실행 전 flush가 됨(=영속성 컨텍스트의 1차 캐시 내용이 DB에 반영됨)
  - flush 후 select 되므로 select에서 결과가 2건이 조회되는 것